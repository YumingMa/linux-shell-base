#!/usr/bin/env bash
# 
# Get the ID of the next window in the class of the active window. The ID of the
# active window will be returned if no other windows in its class exist.
# 

getwindidsinclass() {
  echo "$(wmctrl -lx | awk -v class="${1}" '$3 ~ class {print $1}')"
}

getactvwindid() {
  echo "$(xprop -root _NET_ACTIVE_WINDOW | cut -d ' ' -f 5 | rev | cut -c 2- | \
      rev | sed 's/^0x/0x0/')"
}

getwindclassbyid() {
  echo "$(xprop -id "${1}" WM_CLASS | sed -n \
      's/[^"]*"\([^"]*\)",\s"\([^"]*\)"/\1.\2/p')"
}

getactvwindclass() {
  echo "$(getwindclassbyid "${ACTV_WIND_ID}")"
}

ACTV_WIND_ID="$(getactvwindid)"

CLASS_WIND_IDS=($(getwindidsinclass "$(getactvwindclass)"))

for indx in ${!CLASS_WIND_IDS[@]}; do
  if [ "${CLASS_WIND_IDS[${indx}]}" = "${ACTV_WIND_ID}" ]; then
    clssWindIdsActvWindIdPos="${indx}"
    break
  fi
done

if [[ "${clssWindIdsActvWindIdPos}" -eq $((${#CLASS_WIND_IDS[@]} - 1)) ]]; then
  echo "${CLASS_WIND_IDS[0]}"
else
  echo "${CLASS_WIND_IDS[$((clssWindIdsActvWindIdPos + 1))]}"
fi
