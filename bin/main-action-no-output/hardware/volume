#!/usr/bin/env bash
# 
# Set or toggle volume level.
# 
# Arguments:
#   1. (Optional) Volume percentage level; if omitted, the next default
#      incremental level will be used.
# 
# Dependencies:
#   amixer
# 

# ======= CONFIGURATIONS ======================

# Default incremental percentage levels
VOLUME_LEVEL1=60
VOLUME_LEVEL2=75
VOLUME_LEVEL3=90

# ======= ! CONFIGURATIONS ======================

if [[ "$#" -ge 1 && ! "${1}" =~ ^[0-9]+$ ]]; then
  notify-send 'volume: invalid arguments'
  exit 1
fi

setVolAndNotify() {
  amixer set Master "${1}"% > /dev/null
  notify-send "Volume: ${1}%"
}

if [ "$#" -gt 0 ]; then
  setVolAndNotify "${1}"
else
  currVol="$(amixer get Master | tail -1 | sed -n \
      's/[^[]*[0-9]* \[\([0-9]*\).*/\1/p')"
  case "${currVol}" in
    0 | 1)
      setVolAndNotify ${VOLUME_LEVEL1}
      ;;
    $((VOLUME_LEVEL1 - 1)) | ${VOLUME_LEVEL1} | $((VOLUME_LEVEL1 + 1)))
      setVolAndNotify ${VOLUME_LEVEL2}
      ;;
    $((VOLUME_LEVEL2 - 1)) | ${VOLUME_LEVEL2} | $((VOLUME_LEVEL2 + 1)))
      setVolAndNotify ${VOLUME_LEVEL3}
      ;;
    $((VOLUME_LEVEL3 - 1)) | ${VOLUME_LEVEL3} | $((VOLUME_LEVEL3 + 1)))
      setVolAndNotify 0
      ;;
    ?*)
      setVolAndNotify ${VOLUME_LEVEL1}
      ;;
  esac
fi
